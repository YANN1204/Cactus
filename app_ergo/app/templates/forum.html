{% extends 'layout.html' %}

{% block content %}

<div class="section-h1">
    <h1>Forums</h1>
</div>

<div class="">

    <div class="div-list forum">
        <h2>{{ data['title'] }}</h2>

        <div class="div-tags forum">
            <span> {{ data['room_name'] }} </span>
            {% for tag in data['tags_name'] %}
                <span> {{ tag }} </span>
            {% endfor %}
        </div>

        <div>
            <img src=" {{ data['avatar'] }} ">
            {{ data['pseudo'] }}
            {{ data['date_created'] }}
            {{ data['forum_subject'] }}
            <button class="btn btn-primary" onclick="toggle_visibility('1');">Répondre</button>
        </div>
    </div>

    <div class="hidden-div" id="1" >
        <p>{{ session["pseudo"] }}</p>
        <form id="com-form" enctype="multipart/form-data" method="POST" action="{{ url_for('com_forum') }}">
            <textarea id="com" name="com" class="form-control"> Ecris ta réponse ici... </textarea>
            <input id="id-forum" name="id-forum" type="hidden" value="{{ data['id'] }}">
            <button type="submit" class="btn btn-primary btn-adopt">Poster ma réponse</button>
        </form>
    </div>

    {% set i = namespace(value=1) %}
    {% for c in range(data["comments"]|length) %}
        {% set i.value = i.value + 1 %}
    <div class="row comment mx-3 div-list forum">
        <div class="col-1">
            <img src=' {{ data["comments"][c]["avatar"] }} ' alt="avatar">
        </div>
        <div class="col">
            <div class="d-flex">
                {{ data["comments"][c]["pseudo"] }}
                {{ data["comments"][c]["date_created"] }}
            </div>
            {{ data["comments"][c]["text"] }}
        </div>
        <button class="btn btn-outline-secondary" onclick="toggle_visibility('{{i.value}}');">Répondre</button>
    </div>
    <div class="hidden-div" id="{{i.value}}" >
        <p>{{ session["pseudo"] }}</p>
        <form id="com-form" enctype="multipart/form-data" method="POST" action="{{ url_for('com_forum') }}">
            <textarea id="com" name="com" class="form-control"> Ecris ta réponse ici... </textarea>
            <input id="id-forum" name="id-forum" type="hidden" value="{{ data['id'] }}">
            <input id="id-com" name="id-com" type="hidden" value="{{ data['comments'][c]['id'] }}">
            <button type="submit" class="btn btn-primary btn-adopt">Poster ma réponse</button>
        </form>
    </div>
    {% endfor %}

</div>

<script type="text/javascript">
    // permet de faire apparaître/disparaître les formulaires de réponse
    function toggle_visibility(id) {
        var e = document.getElementById(id);
        if(e.style.display == 'block')
           e.style.display = 'none';
        else
           e.style.display = 'block';
    }
</script>

{% endblock %}